<include file="Public/header" />
<include file="Public/navbar" />

<style media="screen">
    .barcard {
        margin-bottom: 1.5rem;
        border: 1px solid #cfd8dc;
        display: flex;
        flex-direction: column;
        background-color: #fff;
    }

    .barcard a {
        text-decoration: none;
    }

    .barcard .card-block {
        flex: 1 1 auto;
        padding: 1.25rem;
    }

    .barcard-primary {
        background-color: #20a8d8;
        border-color: #fff;
    }

    .barcard-primary .card-block {
        color: #fff;
    }

    .barcard-default {
        background-color: rgba(255, 255, 255, 0.7);
        border-color: #fff;
    }

    .barcard-default .card-block {
        color: #888;
    }
</style>

<div class="container-fluid">
    <div class="row">
        <include file="Public/accountleft" />
        <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
            <ol class="breadcrumb">
                <li><a href="{:U('Index/index')}">主页</a></li>
                <li class="active">管理员信息</li>
            </ol>
            <!-- 导航栏 -->
            <div class="col-sm-12 col-md-12">
                <div class="col-sm-3 col-md-3">
                    <div class="barcard barcard-primary">
                        <a href="#">
                            <div class="card-block">
                                <h4 class="mb-0">账号</h4>
                                <p>显示管理员列表</p>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-sm-3 col-md-3">
                    <div class="barcard barcard-default">
                        <a href="{:U('addManager')}">
                            <div class="card-block">
                                <h4 class="mb-0">增加</h4>
                                <p>添加新的管理员</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <!-- END 导航栏 -->
            <!-- 内容 -->
            <div class="col-sm-12 col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">管理员列表</h3>
                    </div>
                    <div style="height:350px;">
                        <table class="table table-striped table-bordered">
                            <tr>
                                <th>账号</th>
                                <th>姓名</th>
                                <th>详情</th>
                                <th>删除账号</th>
                            </tr>
                            <volist name="list" id="vo">
                                <tr>
                                    <td>{$vo.username}</td>
                                    <td>{$vo.nickname}</td>
                                    <td><a href="#" class="btn-admin-info" value="{$vo.id}">账号信息</a>|<a href="#" class="btn-mod-info" value="{$vo.id}">修改信息</a></td>
                                    <td><a href="#" class="btn-del-admin" value="{$vo.id}">删除</a></td>
                                </tr>
                            </volist>
                        </table>
                    </div>
                    <div class="col-sm-6 col-sm-offset-3">
                        <nav aria-label="...">
                            <ul class="pager">
                                <li>{$page}</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <!-- END 内容 -->
        </div>
    </div>
</div>

<!-- 个人信息 Modal -->
<div class="modal fade bs-example-modal-sm" id="adminInfoModal" tabindex="-1" role="dialog" aria-labelledby="StuInfoModal">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="adminInfoLabel">Modal title</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered">
                    <tr>
                        <td>账号</td>
                        <td id="admin_username"></td>
                    </tr>
                    <tr>
                        <td>密码</td>
                        <td id="admin_password"></td>
                    </tr>
                    <tr>
                        <td>职称</td>
                        <td id="admin_position"></td>
                    </tr>

                    <tr>
                        <td>邮箱地址</td>
                        <td id="admin_email"></td>
                    </tr>
                    <tr>
                        <td>联系电话</td>
                        <td id="admin_phone"></td>
                    </tr>
                    <tr>
                        <td>QQ号码</td>
                        <td id="admin_tecentnumber"></td>
                    </tr>
                    <tr>
                        <td>创建时间</td>
                        <td id="admin_createtime"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- 个人信息 Modal end-->
<!-- 修改信息modal -->
<div class="modal fade" tabindex="-1" role="dialog" id='modModal' tabindex="-1" role="dialog" aria-labelledby="modModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">修改信息</h4>
            </div>
            <form class="form-horizontal">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">姓名</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="mod-nickname" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">职称</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="mod-position" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">邮箱地址</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="mod-email" placeholder="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">联系电话</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="mod-phonenumber" placeholder="">
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="btn-do-mod" value="">保存修改</button>
                </div>
            </form>

        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- 修改信息modal end -->

<script type="text/javascript">
    $(function() {
        //显示修改modal
        $('.btn-mod-info').click(function() {
            var id = $(this).attr('value');
            $.ajax({
                type: 'get',
                url: "{:U('getAdminInfo')}",
                data: {
                    id: id,
                },
                cache: false,
                dataType: 'json',
                timeout: 5000,
                success: function(data) {
                    var data = eval('(' + data + ')');
                    $('#btn-do-mod').val(data.id);
                    $('#mod-nickname').val(data.nickname);
                    $('#mod-position').val(data.position);
                    $('#mod-email').val(data.email);
                    $('#mod-phonenumber').val(data.phonenumber);
                    $('#modModal').modal('show');
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("出错了，请重新尝试");
                },
            });

        });
        //确认修改
        $('#btn-do-mod').click(function() {
            var id = $(this).val();
            var nickname = $('#mod-nickname').val();
            var position = $('#mod-position').val();
            var email = $('#mod-email').val();
            var phonenumber = $('#mod-phonenumber').val();
            $('#modModal').modal('hide');
            $.ajax({
                type: 'post',
                url: "{:U('modAdminInfo')}",
                data: {
                    id: id,
                    nickname: nickname,
                    position: position,
                    email: email,
                    phonenumber: phonenumber,
                },
                cache: false,
                dataType: 'json',
                timeout: 5000,
                success: function(data) {
                    if (data == 1) {
                        alert('修改成功');
                        window.location.reload();
                    } else alert(data);
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("出错了，请重新尝试");
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                },
            });
        });
        //账号详情
        $('.btn-admin-info').click(function() {
            var id = $(this).attr('value');
            $.ajax({
                type: "get",
                url: "{:U('returnOneAdminInfo')}",
                data: {
                    id: id
                },
                cache: false,
                dataType: 'json',
                timeout: 5000,
                success: function(data) {
                    var data = eval('(' + data + ')');
                    $('#adminInfoLabel').text(data.nickname);
                    $('#admin_username').text(data.username);
                    $('#admin_password').text(data.password);
                    $('#admin_position').text(data.position);
                    $('#admin_phone').text(data.phonenumber);
                    $('#admin_email').text(data.email);
                    $('#admin_tecentnumber').text(data.tecentnumber);
                    $('#admin_createtime').text(data.signuptime);
                    $("#adminInfoModal").modal('show');
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("出错了，请重新尝试");
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                },
            });
        });
        //删除信息
        $('.btn-del-admin').click(function() {
            var id = $(this).attr('value');
            $.ajax({
                type: "post",
                url: "{:U('delManager')}",
                data: {
                    id: id
                },
                cache: false,
                dataType: 'json',
                timeout: 5000,
                success: function(data) {
                    if (data == 1) {
                        alert("删除成功");
                        window.location.reload();
                    } else alert(data);
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("出错了，请重新尝试");
                    console.log(XMLHttpRequest.status);
                    console.log(XMLHttpRequest.readyState);
                    console.log(textStatus);
                },
            });
        });

    });
</script>
<include file="Public/footer" />
